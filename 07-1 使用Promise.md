# 07-1 使用Promise

```
參考資料: https://developer.mozilla.org/zh-TW/docs/Web/JavaScript/Reference/Global_Objects/Promise

Promise物件內由使用者自訂一個函式, 其執行結果有成功或失敗的情況.
```

### (1-1) 測試資料, exams.csv 

```javascript
120001,蔡家雅,69,76,58,85
120002,張怡宇,50,42,47,42
120003,王庭棋,84,86,59,63
120004,黃和夫,76,80,78,82
120005,林于文,58,87,68,54
120006,唐馨馨,89,59,98,42
120007,張韻庭,57,81,67,89
120008,應立煌,68,68,78,78
120009,賀家政,63,93,59,66
120010,游惠嘉,81,91,91,64
120011,林佑倫,77,98,89,43
120012,孫宥葳,98,76,45,65
120013,黃岑秀,70,91,61,61
120014,楊雅柔,87,73,84,60
120015,李至君,55,81,78,83
120016,陳怡婷,100,94,76,72
120017,林雅文,65,67,64,88
120018,謝羿婷,71,68,65,49
120019,郭玟寧,61,56,80,67
120020,方翊郁,86,80,56,82
120021,洪亭瑩,73,51,33,70
120022,莊盈琳,71,82,56,77
120023,陳子傑,54,63,73,69
120024,徐冠運,51,77,82,52
120025,邱典鳴,82,48,79,68
120026,何冠斌,76,61,56,62
120027,劉潔容,75,67,38,44
120028,王尉瑩,55,44,79,76
120029,徐盈菁,63,90,83,38
120030,何慈貞,96,44,54,62
120031,黃宜勻,84,67,77,86
120032,陳霈蓁,69,60,62,52
120033,賴孟穎,80,84,47,42
120034,沈家佑,47,41,72,49
120035,朱羚儒,72,76,56,79
120036,蕭宛倫,63,61,67,66
120037,余艾芳,68,58,59,64
120038,呂德雯,65,48,85,73
120039,林雅霖,90,97,79,80
120040,程俐婷,85,81,73,56
120041,陳俐平,85,61,67,63
120042,林一妤,57,90,75,86
120043,徐芷妤,86,78,78,67
120044,郭妤文,73,61,76,64
120045,陳敏庭,69,70,83,73
120046,羅毓芹,56,65,67,57
120047,陳煜文,73,50,65,84
120048,黃宜馨,55,70,59,65
120049,蔡彥娟,53,86,96,85
120050,丁淑儒,61,58,85,75
```


### (1-2) 程式範例, 逐行讀入csv檔案(可測試檔案不存在情況)

```javascript
//------------------------------------------
// 使用嚴格模式
//------------------------------------------
'use strict';

//------------------------------------------
// 引用需要的模組
//------------------------------------------
const fs = require('fs');
const readline = require('readline');

//------------------------------------------
// 建立一個Promise物件, 結果可能是:
//   (1)成功: 呼叫resolve()
//   (2)失敗: 呼叫reject()
//------------------------------------------
const promise = new Promise((resolve, reject) => {
    let array = [];

    //定義讀入串流
    let inputStream = fs.createReadStream('exams.csv');
    inputStream.on('error', (error) => {
        reject(error);  //執行失敗
    });

    //建立一個讀入資料的物件
    let lineReader = readline.createInterface({ 
        input: inputStream 
    });

    //當讀入一行資料時
    lineReader.on('line', function(data) {    
        array.push(data);
    });

    //當檔案全部讀完時
    lineReader.on('close', function() {    
        resolve(array);  //執行成功
    });
});


//------------------------------------------
// 執行Promise工作, 等待resolve或reject,
// 當resolve()被呼叫時, 執行成功的函式;
// 當reject()被呼叫時, 執行失敗的函式.
//------------------------------------------
promise.then((value) => {
    console.log(value);  //接收成功回傳
}, (error) => {
    console.log('錯誤:檔案不存在' + error);  //接收失敗回傳
});
```
