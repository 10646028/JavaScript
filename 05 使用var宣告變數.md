# 05 使用var宣告變數

### (1) 區域變數及廣域變數

```
在函式中用var宣告一個變數時, 該變數的作用範圍在其被宣告的函式內, 是一個區域變數;
用var在函式外宣告一個變數時, 該變數可由各個函式共用, 稱為廣域變數.
```

```javascript
//------------------------------
// 宣告廣域變數
//------------------------------
var m = 50;  //廣域變數

//------------------------------
// 一個執行相加的函式
//------------------------------
function add(a, b=15){
    var m = a + b;  //區域變數
    return m;
}

//------------------------------
// 主程式
//------------------------------
console.log(add(10, 20));   //30
console.log(m);             //50
```


### (2) 在函式中使用廣域變數

```
在函式中使用一個未經var宣告的變數, 實際使用的變數是由該函數向外一層一層找包覆它的區域, 
並且使用最近的那一層有宣告的變數, 向外找的最終點就是最外層的廣域變數.
```

```javascript
//------------------------------
// 宣告廣域變數
//------------------------------
var m = 50;  //廣域變數

//------------------------------
// 一個執行相加的函式
//------------------------------
function add(a, b=15){
    m = a + b;  //未宣告m, 將使用外層的變數
    return m;
}

//------------------------------
// 主程式
//------------------------------
console.log(add(10, 20));   //30
console.log(m);             //30
```


### (3) 內層函式使用外層函式的變數

```javascript
//------------------------------
// 宣告廣域變數
//------------------------------
var m = 50;  //廣域變數

//------------------------------
// 一個執行相加的函式
//------------------------------
function add(a, b=15){
    var m = 30;  //區域變數

    //函式中的函式
    function abc(){
        if(a > b){
            m = a*10 + b;  //使用外層m (區域變數)
        }else{
            m = a + b*10;  //使用外層m (區域變數)
        }
    };
    
    abc();         
    return m;
}

//------------------------------
// 主程式
//------------------------------
console.log(add(10, 20));   //210
console.log(m);             //50
```


### (4) 在函式中使用一個未曾宣告的變數

```
在函式中使用一個逐層向外都未宣告的變數, 最後將創造一個該變數的廣域變數.
```

```javascript
//------------------------------
// 一個執行相加的函式
//------------------------------
function add(a, b=15){
    //函式中的函式
    function abc(){
        if(a > b){
            m = a*10 + b;  //將創造一個廣域變數m
        }else{
            m = a + b*10;  //將創造一個廣域變數m
        }
    };

    abc();     
    
    return m;
}

//------------------------------
// 主程式
//------------------------------
console.log(add(10, 20));   //210
console.log(m);             //210
```


### (5) 使用嚴格模式, 不允許使用未宣告的變數

```javascript
//--------------------------------------
// 使用嚴格模式, 使用的變數一定要事前宣告
//--------------------------------------
'use strict';

//--------------------------------------
// 一個執行相加的函式
//--------------------------------------
function add(a, b=15){
    //函式中的函式
    function abc(){
        if(a > b){
            m = a*10 + b;  //有錯! m未曾宣告
        }else{
            m = a + b*10;  //有錯! m未曾宣告
        }
    };

    abc();     
    
    return m;
}

//--------------------------------------
// 主程式
//--------------------------------------
console.log(add(10, 20));   
console.log(m);   
```


### (6-1) 在函式內的if指令中宣告var變數

```
在函式內的if指令中宣告var變數, 是重新宣告一次d函式內的區域變數, 很容易造成不預期的問題.
建議在if, for等指令範圍內用let指令宣告自己使用的區域變數.
```

```javascript
//------------------------------
// 宣告廣域變數
//------------------------------
var m = 50;  //廣域變數

//------------------------------
// 一個執行相加的函式
//------------------------------
function add(a, b=15){
    var m = 30;  //區域變數

    if(a > b){        
        var m = a*10 + b;   //重新宣告一次add函式內的區域變數m
    }else{
        var m = a + b*10;   //重新宣告一次add函式內的區域變數m
    }

    console.log(m);  //210

    return m;
}

//------------------------------
// 主程式
//------------------------------
console.log(add(10, 20));   //210
console.log(m);             //50 
```


### (6-2) 在函式內的if指令中宣告let變數

```
用let宣告if, for等指令範圍內的區域變數.
以下範例邏輯有問題, 只用來示範var及let的不同.
```

```javascript
//------------------------------
// 宣告廣域變數
//------------------------------
var m = 50;  //廣域變數

//------------------------------
// 一個執行相加的函式
//------------------------------
function add(a, b=15){
    var m = 30;  //區域變數

    if(a > b){        
        let m = a*10 + b;   //屬於if內的區域變數
    }else{
        let m = a + b*10;   //屬於else內的區域變數
    }

    console.log(m);  //30

    return m;
}

//------------------------------
// 主程式
//------------------------------
console.log(add(10, 20));   //30
console.log(m);             //50
```
